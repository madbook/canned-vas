function _toArray(e){return Array.prototype.slice.call(e)}function CannedVas(e){this.ctx=e instanceof HTMLCanvasElement?e.getContext("2d"):e;this.vas=this.ctx.canvas}typeof module!="undefined"&&typeof module.exports!="undefined"&&(module.exports=CannedVas);var PI=Math.PI,TAU=PI*2;CannedVas.can=function(e){return new CannedVas(e)};CannedVas.prototype.globalCompositeOperation=CannedVas.prototype.compositeOperation=function(e){if(e===undefined)return this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation=e;return this};CannedVas.prototype.globalAlpha=CannedVas.prototype.alpha=function(e){if(e===undefined)return this.ctx.globalAlpha;this.ctx.globalAlpha=e;return this};CannedVas.prototype.fillStyle=function(e){if(e===undefined)return this.ctx.fillStyle;this.ctx.fillStyle=e;return this};CannedVas.prototype.strokeStyle=function(e,t){if(e===undefined)return this.ctx.strokeStyle;this.ctx.strokeStyle=e;t!==undefined&&this.lineWidth(t);return this};CannedVas.prototype.paintStyle=function(e){if(e===undefined)return this.ctx.fillStyle;this.ctx.fillStyle=e;this.ctx.strokeStyle=e;return this};CannedVas.prototype.lineWidth=function(e){if(e===undefined)return this.ctx.lineWidth=e;this.ctx.lineWidth=e;return this};RENDERING_CONTEXT_2D_PROPERTIES=["font","textAlign","textBaseLine","lineCap","lineDashOffset","lineJoin","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY"];RENDERING_CONTEXT_2D_PROPERTIES.forEach(function(e){CannedVas.prototype[e]=function(t){if(t===undefined)return this.ctx[e];this.ctx[e]=t;return this}});CannedVas.prototype.width=function(e){if(e===undefined)return this.vas.width;this.vas.width=e;return this};CannedVas.prototype.height=function(e){if(e===undefined)return this.vas.height;this.vas.height=e;return this};CannedVas.prototype.getLineDash=function(){return this.ctx.getLineDash()};CannedVas.prototype.setLineDash=function(e){this.ctx.setLineDash(e);return this};CannedVas.prototype.lineDash=function(e){return e===undefined?this.ctx.getLineDash():this.ctx.setLineDash(e)};CannedVas.prototype.imageSmoothing=CannedVas.prototype.imageSmoothingEnabled=function(e){if(e===undefined)return this.ctx.imageSmoothingEnabled;this.ctx.imageSmoothingEnabled=e;return this};var CSS_PROPERTIES=["width","height","background","backgroundColor","backgroundImage","backgroundPosition","border","zIndex","position","left","top","display"];CSS_PROPERTIES.forEach(function(e){CannedVas.prototype["style"+e[0].toUpperCase()+e.slice(1)]=function(t){if(t===undefined)return window.getComputedStyle(this.vas)[e];this.vas.style[e]=t;return this}});CannedVas.prototype.save=function(){this.ctx.save();return this};CannedVas.prototype.restore=function(){this.ctx.restore();return this};CannedVas.prototype.rect=function(e,t,n,r){this.ctx.rect(e,t,n,r);return this};CannedVas.prototype.clearRect=function(e,t,n,r){this.ctx.clearRect(e,t,n,r);return this};CannedVas.prototype.clipRect=function(e,t,n,r){return this.beginPath().rectangle(e,t,n,r).clip()};CannedVas.prototype.fillRect=function(e,t,n,r){this.ctx.fillRect(e,t,n,r);return this};CannedVas.prototype.strokeRect=function(e,t,n,r){this.ctx.strokeRect(e,t,n,r);return this};CannedVas.prototype.paintRect=function(e,t,n,r){this.ctx.fillRect(e,t,n,r);this.ctx.strokeRect(e,t,n,r);return this};CannedVas.prototype.box=function(e,t,n,r){this.ctx.rect(e-n/2,t-r/2,n,r);return this};CannedVas.prototype.clearBox=function(e,t,n,r){this.ctx.clearRect(e-n/2,t-r/2,n,r);return this};CannedVas.prototype.clipBox=function(e,t,n,r){return this.beginPath().box(e,t,n,r).clip()};CannedVas.prototype.fillBox=function(e,t,n,r){this.ctx.fillRect(e-n/2,t-r/2,n,r);return this};CannedVas.prototype.strokeBox=function(e,t,n,r){this.ctx.strokeRect(e-n/2,t-r/2,n,r);return this};CannedVas.prototype.paintBox=function(e,t,n,r){this.ctx.fillRect(e-n/2,t-r/2,n,r);this.ctx.strokeRect(e-n/2,t-r/2,n,r);return this};CannedVas.prototype.circle=function(e,t,n){this.ctx.arc(e,t,n,0,TAU);return this};CannedVas.prototype.clearCircle=function(e,t,n){var r=this.ctx.globalAlpha,i=this.ctx.globalCompositeOperation;this.ctx.globalAlpha=1;this.ctx.globalCompositeOperation="destination-out";this.beginPath().circle(e,t,n).fill();this.ctx.globalCompositeOperation=i;this.ctx.globalAlpha=r;return this};CannedVas.prototype.clipCircle=function(e,t,n){return this.beginPath().circle(e,t,n).closePath().clip()};CannedVas.prototype.fillCircle=function(e,t,n){return this.beginPath().circle(e,t,n).fill()};CannedVas.prototype.strokeCircle=function(e,t,n){return this.beginPath().circle(e,t,n).stroke()};CannedVas.prototype.paintCircle=function(e,t,n){return this.beginPath().circle(e,t,n).fill().stroke()};CannedVas.prototype.text=function(e,t,n,r){};CannedVas.prototype.clearText=function(e,t,n,r){var i=this.ctx.globalAlpha,s=this.ctx.globalCompositeOperation;this.ctx.globalAlpha=1;this.ctx.globalCompositeOperation="destination-out";this.ctx.fillText(e,t,n,r);this.ctx.globalCompositeOperation=s;this.ctx.globalAlpha=i;return this};CannedVas.prototype.clipText=function(e,t,n,r){};CannedVas.prototype.fillText=function(e,t,n,r){r===undefined?this.ctx.fillText(e,t,n):this.ctx.fillText(e,t,n,r);return this};CannedVas.prototype.strokeText=function(e,t,n,r){r===undefined?this.ctx.strokeText(e,t,n):this.ctx.strokeText(e,t,n,r);return this};CannedVas.prototype.paintText=function(e,t,n,r){return this.fillText(e,t,n,r).strokeText(e,t,n,r)};CannedVas.prototype.canvas=function(){this.rect(0,0,this.vas.width,this.vas.height);return this};CannedVas.prototype.clearCanvas=function(){var e=this.ctx;e.clearRect(0,0,e.canvas.width,e.canvas.height);return this};CannedVas.prototype.clipCanvas=function(){};CannedVas.prototype.fillCanvas=function(){this.ctx.fillRect(0,0,this.vas.width,this.vas.height);return this};CannedVas.prototype.strokeCanvas=function(){this.ctx.strokeRect(0,0,this.vas.width,this.vas.height);return this};CannedVas.prototype.paintCanvas=function(){this.ctx.fillRect(0,0,this.vas.width,this.vas.height);this.ctx.strokeRect(0,0,this.vas.width,this.vas.height);return this};CannedVas.prototype.drawImage=function(){this.ctx.drawImage.apply(this.ctx,_toArray(arguments));return this};CannedVas.prototype.drawImageAt=function(e,t,n){this.ctx.drawImage(e,t,n);return this};CannedVas.prototype.drawImageIn=function(e,t,n,r,i){this.ctx.drawImage(e,t,n,r,i);return this};CannedVas.prototype.drawImageCrop=function(e,t,n,r,i,s,o){this.ctx.drawImage(e,t,n,r,i,s,o,r,i);return this};CannedVas.prototype.drawImageCropIn=function(e,t,n,r,i,s,o,u,a){this.ctx.drawImage(e,t,n,r,i,s,o,u,a);return this};CannedVas.prototype.drawImageCentered=function(e){var t=this.ctx;t.drawImage(e,-e.width/2,-e.height/2,e.width,e.height);return this};CannedVas.prototype.drawImageCanvas=function(e){var t=this.ctx;t.drawImage(e,0,0,e.width,e.height,0,0,t.canvas.width,t.canvas.height);return this};CannedVas.prototype.drawImageFromRect=function(e){this.ctx.drawImageFromRect(e);return this};CannedVas.prototype.drawCustomFocusRing=function(e){this.ctx.drawCustomFocusRing(e);return this};CannedVas.prototype.drawSystemFocusRing=function(e){this.ctx.drawSystemFocusRing(e);return this};CannedVas.prototype.beginPath=function(){this.ctx.beginPath();return this};CannedVas.prototype.moveTo=function(e,t){this.ctx.moveTo(e,t);return this};CannedVas.prototype.line=function(e,t,n,r){this.ctx.moveTo(e,t);this.ctx.lineTo(n,r);return this};CannedVas.prototype.lineTo=function(e,t){this.ctx.lineTo(e,t);return this};CannedVas.prototype.arc=function(e,t,n,r,i,s){this.ctx.arc(e,t,n,r,i,s);return this};CannedVas.prototype.arcTo=function(e,t,n,r,i){this.ctx.arcTo(e,t,n,r,i);return this};CannedVas.prototype.bezierCurveTo=function(e,t,n,r,i,s){this.ctx.bezierCurveTo(e,t,n,r,i,s);return this};CannedVas.prototype.quadraticCurveTo=function(e,t,n,r){this.ctx.quadraticCurveTo(e,t,n,r);return this};CannedVas.prototype.closePath=function(){this.ctx.closePath();return this};CannedVas.prototype.clear=function(){var e=this.ctx.globalAlpha,t=this.ctx.globalCompositeOperation;this.ctx.globalAlpha=1;this.ctx.globalCompositeOperation="destination-out";this.ctx.fill();this.ctx.globalCompositeOperation=t;this.ctx.globalAlpha=e;return this};CannedVas.prototype.clip=function(){this.ctx.clip();return this};CannedVas.prototype.fill=function(){this.ctx.fill();return this};CannedVas.prototype.stroke=function(){this.ctx.stroke();return this};CannedVas.prototype.paint=function(){this.ctx.fill();this.ctx.stroke();return this};CannedVas.prototype.rotate=function(e){this.ctx.rotate(e);return this};CannedVas.prototype.scale=function(e,t){this.ctx.scale(e,t);return this};CannedVas.prototype.translate=function(e,t){this.ctx.translate(e,t);return this};CannedVas.prototype.translateToCenter=function(){this.ctx.translate(this.vas.width/2|0,this.vas.height/2|0);return this};CannedVas.prototype.translateFromCenter=function(){this.ctx.translate(this.vas.width/-2|0,this.vas.height/-2|0);return this};CannedVas.prototype.transform=function(e,t,n,r,i,s){this.ctx.transform(e,t,n,r,i,s);return this};CannedVas.prototype.setTransform=function(e,t,n,r,i,s){this.ctx.setTransform(e,t,n,r,i,s);return this};CannedVas.prototype.resetTransform=function(){this.ctx.resetTransform();return this};CannedVas.prototype.scrollPathIntoView=function(){this.ctx.scrollPathIntoView();return this};CannedVas.prototype.isPointInPath=function(e,t){return this.ctx.isPointInPath(e,t)};CannedVas.prototype.isPointInStroke=function(e,t){return this.ctx.isPointInStroke(e,t)};CannedVas.prototype.currentPath=function(){return this.ctx.currentPath};CannedVas.prototype.createImageData=function(e,t){if(typeof arguments[0]!="object"){arguments[0]=arguments[0]||this.width();arguments[1]=arguments[1]||this.height()}return this.ctx.createImageData.apply(this.ctx,_toArray(arguments))};CannedVas.prototype.getImageData=function(e,t,n,r){e|=0;t|=0;n=n||this.width();r=r||this.height();return this.ctx.getImageData(e,t,n,r)};CannedVas.prototype.putImageData=function(e,t,n,r,i,s,o){t|=0;n|=0;r===undefined?this.ctx.putImageData(e,t,n):this.ctx.putImageData(e,t,n,r,i,s,o);return this};CannedVas.prototype.imageData=function(e){if(e===undefined)return this.ctx.getImageData(0,0,this.vas.width,this.vas.height);this.ctx.putImageData(e,0,0);return this};CannedVas.prototype.measureText=function(e){return this.ctx.measureText(e)};CannedVas.prototype.textWidth=function(e){return this.ctx.measureText(e).width};CannedVas.prototype.textHeight=function(){var e=document.createElement("div");document.body.appendChild(e);e.innerHTML="m";e.style.font=this.font();e.style.lineHeight="1em";var t=e.offsetHeight;document.body.removeChild(e);return t};CannedVas.prototype.createLinearGradient=function(e,t,n,r){return this.ctx.createLinearGradient(e,t,n,r)};CannedVas.prototype.createRadialGradient=function(e,t,n,r,i,s){return this.ctx.createRadialGradient(e,t,n,r,i,s)};CannedVas.prototype.createPattern=function(e,t){return this.ctx.createPattern(e,t)};CannedVas.prototype.toDataURL=function(e){return this.vas.toDataURL(e)};CannedVas.prototype.toBlob=function(e,t,n){return this.vas.toBlob(e,t,n)};CannedVas.prototype.size=function(e){if(e===undefined)return{width:this.vas.width,height:this.vas.height};this.width(e.width);this.height(e.height);return this};CannedVas.prototype.createCanvas=function(){var e=new CannedVas(document.createElement("canvas"));e.width(this.width());e.height(this.height());return e};CannedVas.prototype.clone=function(){return this.createCanvas().drawImage(this.vas,0,0)};var PROPERTIES_TO_COPY=["fillStyle","strokeStyle","lineWidth","font","textAlign","textBaseLine","globalAlpha","globalCompositeOperation"];CannedVas.prototype.copyStyle=function(e){PROPERTIES_TO_COPY.forEach(function(t){this[t](e[t]())},this);return this};CannedVas.prototype.open=function(e){e instanceof Function&&e.apply(this,_toArray(arguments).slice(1));return this};CannedVas.prototype.cannery=function(e,t){if(!Array.isArray(t))throw"Object must be an array";if(typeof e!="function")throw"Must provide a function";var n=_toArray(arguments).slice(2);t.forEach(function(t){e.apply(this,[t].concat(n))},this);return this};CannedVas.prototype.filter=function(e){var t=this.getImageData(),n=this.createImageData(t);this.open(e,t,n);this.putImageData(n);return this};CannedVas.createMatrixFilter=function(e){return function(t,n){CannedVas.applyMatrixFilter(t,n,e)}};CannedVas.applyMatrixFilter=function(e,t,n){var r=e.width,i=e.height,s=n[0].length,o=n.length,u=s/2|0,a=o/2|0,f=[0,0,0],l,c,h,p,d,v,m,g,y;e=e.data;t=t.data;c=i;while(l=r,c--)while(l--,h=(c*r+l)*4,d=o,l){y=f.length;while(y--)f[y]=0;while(d--)if((m=d-a+c)&&m>=0&&m<i&&(p=s))while(p--)if((v=p-u+l)&&v>=0&&v<r&&(g=(m*r+v)*4,y=3))while(y--)f[y]+=e[g+y]*n[d][p];y=f.length;while(y--)t[h+y]=f[y]}c=i;while(l=r,c--)while(l--,h=(c*r+l)*4,l)t[h+3]=e[h+3]};